{% load static %}
<!DOCTYPE html>


<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <meta name="description" content="POS - Bootstrap Admin Template">
    <meta name="keywords"
          content="admin, estimates, bootstrap, business, corporate, creative, management, minimal, modern,  html5, responsive">
    <meta name="author" content="Dreamguys - Bootstrap Admin Template">
    <meta name="robots" content="noindex, nofollow">
    <meta name="django-app" content="true">


    <title>Ledger PRO</title>

 <script>
if({{user.dark_mode}}==1){
document.querySelector("html").setAttribute("data-layout-mode", 'dark_mode');
}else{
document.querySelector("html").setAttribute("data-layout-mode", 'light_mode');
}
</script>


    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'bootstrap/assets/img/favicon.png' %}">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="{% static 'bootstrap/assets/css/bootstrap.min.css' %}">

    <link rel="stylesheet" href="{% static 'bootstrap/assets/plugins/select2/css/select2.min.css' %}">

    <!-- animation CSS -->
    <link rel="stylesheet" href="{% static 'bootstrap/assets/css/animate.css' %}">

    <!-- Datatable CSS -->
    <link rel="stylesheet" href="{% static 'bootstrap/assets/css/dataTables.bootstrap5.min.css' %}">

    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="{% static 'bootstrap/assets/plugins/fontawesome/css/fontawesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'bootstrap/assets/plugins/fontawesome/css/all.min.css' %}">

    <!-- Main CSS -->
    <link rel="stylesheet" href="{% static 'bootstrap/assets/css/style.css' %}">

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">


    <link href="{% static 'bootstrap/assets/plugins/summernote/summernote-bs4.min.css' %}" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'bootstrap/assets/css/dataTables.bootstrap5.min.css' %}">


    {% include 'layouts2/header.html' %}
    {% block header %}{% endblock header %}
    <style>
        body.blur-active > *:not(#passwordOverlay):not(.modal-backdrop) {
    filter: blur(5px);
    pointer-events: none;
}

    </style>
</head>
<body>
{% block body %}{% endblock body %}
<div id="global-loader">
    <div class="whirly-loader"></div>
</div>
<!-- Main Wrapper -->
<div class="main-wrapper">

    <!-- Header -->
    <div class="header no-print">

        <!-- Logo -->
        <div class="header-left active">
            <a href="{% url 'dashboard' %}" class="logo logo-normal">
                <img src="{% static 'bootstrap/assets/img/logo.png' %}" alt="">
            </a>
            <a href="{% url 'dashboard' %}" class="logo logo-white">
                <img src="{% static 'bootstrap/assets/img/logo-white.png' %}" alt="">
            </a>
            <a href="{% url 'dashboard' %}" class="logo-small">
                <img src="{% static 'bootstrap/assets/img/logo-small.png' %}" alt="">
            </a>
            <a id="toggle_btn" href="javascript:void(0);">
                <i data-feather="chevrons-left" class="feather-16"></i>
            </a>
        </div>
        <!-- /Logo -->

        <a id="mobile_btn" class="mobile_btn" href="#sidebar">
					<span class="bar-icon">
						<span></span>
						<span></span>
						<span></span>
					</span>
        </a>

        <!-- Header Menu -->
        <ul class="nav user-menu">

            <!-- Search -->
            <li class="nav-item nav-searchinputs">


            </li>
            <!-- /Search -->


            <!-- Select Store -->
            <li class="nav-item dropdown has-arrow main-drop select-store-dropdown">
                <a href="javascript:void(0);" class="dropdown-toggle nav-link select-store"
                   data-bs-toggle="dropdown">
							<span class="user-info">
								<span class="user-letter">
									<img src="{% static 'bootstrap/assets/img/store/store-01.png' %}" alt="Store Logo"
                                         class="img-fluid">
								</span>
								<span class="user-detail">
									<span class="user-name"><nobr>{{ COMPANY.company_name }}</nobr></span>
								</span>
							</span>
                </a>
                <div class="dropdown-menu dropdown-menu-right">

                    {% for company in COMPANY_LIST %}

                    {% if COMPANY.id != company.id %}

                    <a href="{% url 'dashboard_company' company.id %}" class="dropdown-item">
                        <img src="{% static 'bootstrap/assets/img/store/store-01.png' %}" alt="Store Logo"
                             class="img-fluid">
                        <nobr>{{ company.company_name }}</nobr>
                    </a>
                    {% endif %}
                    {% endfor %}


                </div>
            </li>
            <!-- /Select Store -->

            <!-- Flag -->
            <li class="nav-item dropdown has-arrow flag-nav nav-item-box">
                <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="javascript:void(0);"
                   role="button">
                    <img src="{% static 'bootstrap/assets/img/flags/us.png' %}" alt="Language" class="img-fluid">
                </a>
                <div class="dropdown-menu dropdown-menu-right">
                    <a href="javascript:void(0);" class="dropdown-item active">
                        <img src="{% static 'bootstrap/assets/img/flags/us.png' %}" alt="" height="16"> English
                    </a>
                    <a href="javascript:void(0);" class="dropdown-item">
                        <img src="{% static 'bootstrap/assets/img/flags/fr.png' %}" alt="" height="16"> French
                    </a>
                    <a href="javascript:void(0);" class="dropdown-item">
                        <img src="{% static 'bootstrap/assets/img/flags/es.png' %}" alt="" height="16"> Spanish
                    </a>
                    <a href="javascript:void(0);" class="dropdown-item">
                        <img src="{% static 'bootstrap/assets/img/flags/de.png' %}" alt="" height="16"> German
                    </a>
                </div>
            </li>
            <!-- /Flag -->

            <li class="nav-item nav-item-box">
                <a href="javascript:void(0);" id="btnFullscreen">
                    <i data-feather="maximize"></i>
                </a>
            </li>
            <li class="nav-item nav-item-box">
                <a href="#">
                    <i data-feather="mail"></i>
                    <span class="badge rounded-pill">1</span>
                </a>
            </li>
            <!-- Notifications -->
            <li class="nav-item dropdown nav-item-box">
                <a href="javascript:void(0);" class="dropdown-toggle nav-link" data-bs-toggle="dropdown">
                    <i data-feather="bell"></i><span class="badge rounded-pill">2</span>
                </a>
                <div class="dropdown-menu notifications">
                    <div class="topnav-dropdown-header">
                        <span class="notification-title">Notifications</span>
                        <a href="javascript:void(0)" class="clear-noti"> Clear All </a>
                    </div>
                    <div class="noti-content">
                        <ul class="notification-list">
                            <li class="notification-message">
                                <a href="activities.html">
                                    <div class="media d-flex">
												<span class="avatar flex-shrink-0">
													<img alt=""
                                                         src="{% static 'bootstrap/assets/img/profiles/avatar-02.jpg' %}">
												</span>
                                        <div class="media-body flex-grow-1">
                                            <p class="noti-details"><span class="noti-title">John Doe</span> added
                                                new task <span class="noti-title">Patient appointment booking</span>
                                            </p>
                                            <p class="noti-time"><span class="notification-time">4 mins ago</span>
                                            </p>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li class="notification-message">
                                <a href="activities.html">
                                    <div class="media d-flex">
												<span class="avatar flex-shrink-0">
													<img alt=""
                                                         src="{% static 'bootstrap/assets/img/profiles/avatar-03.jpg' %}">
												</span>
                                        <div class="media-body flex-grow-1">
                                            <p class="noti-details"><span class="noti-title">Tarah Shropshire</span>
                                                changed the task name <span class="noti-title">Appointment booking
															with payment gateway</span></p>
                                            <p class="noti-time"><span class="notification-time">6 mins ago</span>
                                            </p>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li class="notification-message">
                                <a href="activities.html">
                                    <div class="media d-flex">
												<span class="avatar flex-shrink-0">
													<img alt=""
                                                         src="{% static 'bootstrap/assets/img/profiles/avatar-06.jpg' %}">
												</span>
                                        <div class="media-body flex-grow-1">
                                            <p class="noti-details"><span class="noti-title">Misty Tison</span>
                                                added <span class="noti-title">Domenic Houston</span> and <span
                                                        class="noti-title">Claire Mapes</span> to project <span
                                                        class="noti-title">Doctor available module</span></p>
                                            <p class="noti-time"><span class="notification-time">8 mins ago</span>
                                            </p>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li class="notification-message">
                                <a href="activities.html">
                                    <div class="media d-flex">
												<span class="avatar flex-shrink-0">
													<img alt=""
                                                         src="{% static 'bootstrap/assets/img/profiles/avatar-17.jpg' %}">
												</span>
                                        <div class="media-body flex-grow-1">
                                            <p class="noti-details"><span class="noti-title">Rolland Webber</span>
                                                completed task <span class="noti-title">Patient and Doctor video
															conferencing</span></p>
                                            <p class="noti-time"><span class="notification-time">12 mins ago</span>
                                            </p>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li class="notification-message">
                                <a href="activities.html">
                                    <div class="media d-flex">
												<span class="avatar flex-shrink-0">
													<img alt=""
                                                         src="{% static 'bootstrap/assets/img/profiles/avatar-13.jpg' %}">
												</span>
                                        <div class="media-body flex-grow-1">
                                            <p class="noti-details"><span class="noti-title">Bernardo Galaviz</span>
                                                added new task <span class="noti-title">Private chat module</span>
                                            </p>
                                            <p class="noti-time"><span class="notification-time">2 days ago</span>
                                            </p>
                                        </div>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="topnav-dropdown-footer">
                        <a href="activities.html">View all Notifications</a>
                    </div>
                </div>
            </li>
            <!-- /Notifications -->

            <li class="nav-item nav-item-box">
                <a href="javascript:change_mode();"><i data-feather="sun"></i></a>
            </li>
            <li class="nav-item dropdown has-arrow main-drop">
                <a href="javascript:void(0);" class="dropdown-toggle nav-link userset" data-bs-toggle="dropdown">
							<span class="user-info">
								<span class="user-letter">
									<img src="{% static 'bootstrap/assets/img/profiles/avator1.jpg' %}" alt=""
                                         class="img-fluid">
								</span>
								<span class="user-detail">
									<span class="user-name">{{user.username}}</span>
									<span class="user-role">{{user.get_position_display}}</span>
								</span>
							</span>
                </a>
                <div class="dropdown-menu menu-drop-user">
                    <div class="profilename">
                        <div class="profileset">
									<span class="user-img"><img
                                            src="{% static 'bootstrap/assets/img/profiles/avator1.jpg' %}" alt="">
										<span class="status online"></span></span>
                            <div class="profilesets">
                                <h6>{{user.username}}</h6>
                                <h5>{{user.get_position_display}}</h5>
                            </div>
                        </div>
                        <hr class="m-0">
                        <a class="dropdown-item" href="{% url 'profile' %}"> <i class="me-2" data-feather="user"></i> My
                            Profile</a>
                        <a class="dropdown-item" href="#"><i class="me-2"
                                                                                 data-feather="settings"></i>Settings</a>
                        <hr class="m-0">
                        <a class="dropdown-item logout pb-0" href="{% url 'logout' %}"><img
                                src="{% static 'bootstrap/assets/img/icons/log-out.svg' %}" class="me-2" alt="img">Logout</a>
                    </div>
                </div>
            </li>
        </ul>
        <!-- /Header Menu -->

        <!-- Mobile Menu -->
        <div class="dropdown mobile-user-menu">
            <a href="javascript:void(0);" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"
               aria-expanded="false"><i class="fa fa-ellipsis-v"></i></a>
            <div class="dropdown-menu dropdown-menu-right">
                <a class="dropdown-item" href="#">My Profile</a>
                <a class="dropdown-item" href="#">Settings</a>
                <a class="dropdown-item" href="{% url 'logout' %}">Logout</a>
            </div>
        </div>
        <!-- /Mobile Menu -->
    </div>
    <!-- /Header -->



{% if request.user.is_superuser or request.user.position == 0 %}
{% include 'layouts2/sidebar.html' %}
{% elif request.user.position == 1 %}
{% include 'layouts2/sidebar.html' %}

{% elif request.user.position == 4 %}
{% include 'layouts2/sidebar_position_4.html' %}
{% else %}
{# Optional fallback sidebar #}
{% include 'layouts2/sidebar.html' %}
{% endif %}


    <!-- Sidebar -->
    {% include 'layouts2/pos_sidebar.html' %}
    <!-- /Sidebar -->




    {% if '/stock/purchase/add_stock/' in request.path %}
    <div class="page-wrapper" style="padding: 0px 0 0;">
    {% else %}
    <div class="page-wrapper">
    {% endif %}

        <div class="content">


            {% block content %}{% endblock content %}

        </div>
    </div>

</div>
<!-- /Main Wrapper -->

{% block modal %}{% endblock modal %}


<div id="passwordOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; z-index:1050; backdrop-filter: blur(5px);"></div>

<!-- Password Modal -->
<div class="modal fade" id="passwordModal" tabindex="-1" aria-labelledby="passwordModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form id="passwordForm">
        <div class="modal-header">
          <h5 class="modal-title">Session Locked</h5>
        </div>
        <div class="modal-body">
          <p>Please enter your password to continue:</p>
          <input type="password" class="form-control" name="password" required autofocus>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Unlock</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Lock Screen -->
<div id="lockScreen" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.5); backdrop-filter: blur(5px); z-index:9999; display:flex; align-items:center; justify-content:center;">
    <div style="background:#fff; padding:2rem; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.3); max-width:300px; width:100%;">
        <h5 class="text-center mb-3">Session Locked</h5>
        <form id="lockForm">
            <input type="password" class="form-control mb-3" placeholder="Enter password" name="password" required autofocus>
            <button type="submit" class="btn btn-warning w-100">Unlock</button>
        </form>
    </div>
</div>




<script src="{% static 'bootstrap/assets/plugins/jquery/dist/jquery.min.js' %}"></script>
<script src="{% static 'bootstrap/assets/plugins/jquery-ui-dist/jquery-ui.min.js' %}"></script>


<!-- jQuery -->
<!--<script src="{% static 'bootstrap/assets/js/jquery-3.7.1.min.js' %}"></script>-->

<!-- Feather Icon JS -->
<script src="{% static 'bootstrap/assets/js/feather.min.js' %}"></script>

<!-- Slimscroll JS -->
<script src="{% static 'bootstrap/assets/js/jquery.slimscroll.min.js' %}"></script>

<!-- Bootstrap Core JS -->
<script src="{% static 'bootstrap/assets/js/bootstrap.bundle.min.js' %}"></script>

<!-- Custom JS -->

<script src="{% static 'bootstrap/assets/js/script.js' %}"></script>

<script src="{% static 'bootstrap/assets/plugins/select2/js/select2.min.js' %}"></script>

<script src="{% static 'bootstrap/assets/plugins/summernote/summernote-bs4.min.js' %}"></script>

<!-- Datatable JS -->
<script src="{% static 'bootstrap/assets/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'bootstrap/assets/js/dataTables.bootstrap5.min.js' %}"></script>
<script src="{% static 'bootstrap/assets/plugins/flatpickr/flatpickr.js' %}"></script>

    <script type="text/javascript">
        $(function() {
            $('.monthPicker1').datepicker( {
            changeMonth: true,
            changeYear: true,
            showButtonPanel: true,
            dateFormat: 'MM yy',
            onClose: function(dateText, inst) {
                $(this).datepicker('setDate', new Date(inst.selectedYear, inst.selectedMonth, 1));
            }
            });
        });
    </script>

<script type="text/javascript">
    $(function () {
        $('.monthPicker').datepicker({
            changeMonth: true,
            changeYear: true,
            showButtonPanel: true,
            dateFormat: 'MM yy', // ⬅️ Show "April 2025"
            onClose: function (dateText, inst) {
                var month = inst.selectedMonth + 1;
                var year = inst.selectedYear;

                if (month < 10) month = '0' + month;

                // This sets display as "April 2025"
                var displayVal = $.datepicker.formatDate('MM yy', new Date(year, inst.selectedMonth, 1));
                $(this).val(displayVal);

                // This replaces value before submission to "202504"
                $(this).data('submit-value', year + '' + month);
            },
            beforeShow: function (input, inst) {
                $(inst.dpDiv).addClass('month-year-picker');
            }
        });

        // Modify value right before form submit
        $('form').on('submit', function () {
            const $input = $('.monthPicker');
            const raw = $input.data('submit-value');
            if (raw) {
                //$input.val(raw); // change value to "202504"
            }
        });
    });
</script>


    <style>
.month-year-picker .ui-datepicker-calendar {
    display: none;
}
</style>




<script>
    $(function() {
   $( ".datepicker" ).datepicker({
       dateFormat: 'dd/mm/yy',
     changeMonth: true,
     changeYear: true
   });
 });


//$( ".datepicker" ).datepicker({format: "dd/mm/yyyy", autoclose: true });

$('input').attr('autocomplete','off');

$(function() {
document.querySelector("html").setAttribute('data-layout-style', 'default');
});
</script>

{% block footer %}
{% endblock footer %}

<!-- BEGIN #footer -->
{% include 'layouts2/footer.html' %}
<!-- END #footer -->


<script>
    if ( window.history.replaceState ) {
      window.history.replaceState( null, null, window.location.href );
    }

function change_mode(){

    val=document.querySelector("html").getAttribute('data-layout-mode');

    if(val=='light_mode'){
    document.querySelector("html").setAttribute("data-layout-mode", 'dark_mode');
    update_data('authentication', 'User', {{user.id}}, 'dark_mode', 1);
    }else{
    document.querySelector("html").setAttribute("data-layout-mode", 'light_mode');
    update_data('authentication', 'User', {{user.id}}, 'dark_mode', 0);
    }

}




/*********** COMMON UPDATE ***************/
function update_data(app_name, model_name, id, field, value){

    $.ajax({
        url: '{% url 'update'  %}',
        method: "POST",
        data: {
            app_name: app_name,
            model_name: model_name,
            id: id,
            field: field,
            value: value,
            csrfmiddlewaretoken: '{{ csrf_token }}',
        },
        success: function(data) {

            return 1
        },
        error: function(error) {
            return 0

        }
    });

}
/*********** END COMMON UPDATE ***************/



/********* CODE FOR ELECTRON *********/
function customPrint() {
  const isElectron = navigator.userAgent.toLowerCase().includes('myelectronapp');

  if (isElectron && window.electron?.ipcRenderer) {
    const element = document.getElementById('print_dos');
    const htmlContent = element?.value || '';


    if (htmlContent.trim()) {
      window.electron.ipcRenderer.send('electron-dos-print', htmlContent);
      console.log('🖨️ Print request sent to Electron main process');
    } else {
      alert('❌ No content to print.');
    }
  } else {
    console.log("🌐 Web environment. Opening browser print dialog.");
    window.print();
  }
}






/********* END CODE FOR ELECTRON *********/


</script>


<script>
    let inactivityTime = function () {
        let timer;

        function resetTimer() {
            clearTimeout(timer);
            timer = setTimeout(showLockScreen, 600000); // 1 minute
        }

        function showLockScreen() {
            $("#lockScreen").fadeIn();
            $("#lockScreen input[name='password']").focus();
        }

        $("#lockForm").on("submit", function (e) {
            e.preventDefault();
            const password = $(this).find("input[name='password']").val();

            $.ajax({
                url: "{% url 'verify_password' %}",
                method: "POST",
                headers: { "X-CSRFToken": "{{ csrf_token }}" },
                data: { password: password },
                success: function (res) {
                    if (res.status === "ok") {
                        $("#lockScreen").fadeOut();
                        $("#lockForm")[0].reset();
                        resetTimer();
                    } else {
                        alert("Wrong password. Logging out.");
                        window.location.href = "{% url 'logout' %}";
                    }
                },
                error: function () {
                    alert("Something went wrong.");
                    window.location.href = "{% url 'logout' %}";
                }
            });
        });

        $(document).on('mousemove keypress click scroll', resetTimer);
        resetTimer();
    };

    $(document).ready(inactivityTime);
</script>



</body>
</html>